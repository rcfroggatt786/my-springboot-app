events { worker_connections 1024;
}
http { include /etc/nginx/mime.types; default_type application/octet-stream;
    # Logging
    log_format main '$remote_addr - $remote_user [$time_local] "$request" ' '$status $body_bytes_sent 
                    "$http_referer" ' '"$http_user_agent" "$http_x_forwarded_for"';
    access_log /var/log/nginx/access.log main; error_log /var/log/nginx/error.log warn;
    # Gzip compression
    gzip on; gzip_vary on; gzip_proxied any; gzip_comp_level 6; gzip_types text/plain text/css text/xml 
    text/javascript application/json application/javascript application/xml+rss application/atom+xml 
    image/svg+xml; upstream springboot {
        server app:8080;
    }
    # HTTP server (for initial setup without SSL)
    server { listen 80; server_name _;
        
        # Let's Encrypt challenge directory (for future SSL setup)
        location /.well-known/acme-challenge/ { root /var/www/html;
        }
        # Health check endpoint (no auth required)
        location /actuator/health { proxy_pass http://springboot; access_log off;
        }
        # All other requests
        location / { proxy_pass http://springboot; proxy_set_header Host $host; proxy_set_header X-Real-IP 
            $remote_addr; proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for; proxy_set_header 
            X-Forwarded-Proto $scheme; proxy_set_header X-Forwarded-Host $host; proxy_set_header 
            X-Forwarded-Port $server_port;
            
            # Timeouts
            proxy_connect_timeout 30s; proxy_send_timeout 30s; proxy_read_timeout 30s;
        }
    }
}

